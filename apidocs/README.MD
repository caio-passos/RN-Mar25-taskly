# ğŸ“± API com Firebase + Firestore

## ğŸ” AutenticaÃ§Ã£o

Todas as rotas (exceto testes locais) exigem autenticaÃ§Ã£o via Firebase Authentication.

**Header obrigatÃ³rio em todas as rotas protegidas:**

```
Authorization: Bearer <idToken>
```

VocÃª pode obter esse token fazendo login com e-mail e senha na API REST do Firebase.

---

## ğŸ“š Rotas da API

### ğŸ”‘ POST `/auth/register`

Registra um novo usuÃ¡rio.

#### ğŸ“¥ Body:

```json
{
  "email": "usuario@email.com",
  "password": "senha123",
  "name": "UsuÃ¡rio Teste",
  "phone_number": "81912345678"
}
```

#### ğŸ” Regras:

- Todos os campos sÃ£o obrigatÃ³rios.
- O campo `phone_number` deve conter apenas nÃºmeros.

#### âœ… Resposta:

```json
{
  "uid": "abc123xyz",
  "idToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

---

### ğŸ”‘ POST `/auth/login`

Realiza o login de um usuÃ¡rio existente.

#### ğŸ“¥ Body:

```json
{
  "email": "usuario@email.com",
  "password": "senha123"
}
```

#### ğŸ” Regras:

- Ambos os campos sÃ£o obrigatÃ³rios.

#### âœ… Resposta:

```json
{
  "id_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "AEu4IL2..."
}
```

---

### ğŸ”‘ POST `/auth/refresh`

Renova o token de autenticaÃ§Ã£o.

#### ğŸ“¥ Body:

```json
{
  "refreshToken": "AEu4IL2..."
}
```

#### ğŸ” Regras:

- O campo `refreshToken` Ã© obrigatÃ³rio.

#### âœ… Resposta:

```json
{
  "idToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "AEu4IL2...",
  "expiresIn": "3600"
}
```

---

### ğŸ‘¤ GET `/profile`

Retorna os dados do usuÃ¡rio autenticado.

#### ğŸ”’ Protegida? Sim

#### âœ… Resposta:

```json
{
  "uid": "abc123xyz",
  "email": "usuario@email.com",
  "name": "UsuÃ¡rio Teste",
  "phone_number": "81912345678",
  "picture": "avatar_2"
}
```

---

### â• PUT `/profile`

Atualiza o perfil do usuÃ¡rio autenticado.

#### ğŸ”’ Protegida? Sim

#### ğŸ“¥ Body:

```json
{
  "name": "JoÃ£o da Silva",
  "phone_number": "11912341234",
  "picture": "avatar_3"
}
```

#### ğŸ” Regras:

- O campo `name` deve ser uma string nÃ£o vazia.
- O campo `phone_number` deve conter apenas nÃºmeros.
- O campo `picture` deve ser um ID vÃ¡lido no formato `avatar_1`, `avatar_2`, ..., `avatar_5`.

#### âœ… Resposta:

```
200 OK
```

---

### âœ… GET `/tasks`

Retorna todas as tarefas do usuÃ¡rio autenticado, incluindo tarefas compartilhadas com ele.

#### ğŸ”’ Protegida? Sim

#### âœ… Exemplo de resposta:

```json
[
  {
    "id": "123abc",
    "title": "Estudar React Native",
    "description": "Finalizar desafio",
    "deadline": "13/04/2025",
    "priority": 2,
    "done": false,
    "createdAt": "2025-04-13T14:20:00.000Z",
    "subtasks": [
      { "title": "Ler documentaÃ§Ã£o", "done": true },
      { "title": "Codar exemplo", "done": false }
    ],
    "tags": ["estudo", "react-native"],
    "sharedWith": ["outro@email.com"]
  }
]
```

---

### â• POST `/tasks`

Cria uma nova tarefa.

#### ğŸ”’ Protegida? Sim

#### ğŸ“¥ Body:

```json
{
  "title": "Nova tarefa",
  "description": "DescriÃ§Ã£o opcional",
  "done": false,
  "deadline": "15/04/2025",
  "priority": 3,
  "subtasks": [
    { "title": "Subtarefa 1", "done": false },
    { "title": "Subtarefa 2", "done": true }
  ],
  "tags": ["tag1", "tag2"]
}
```

#### ğŸ” Regras:

- `title` Ã© obrigatÃ³rio e deve ser uma string nÃ£o vazia.
- `description` Ã© opcional.
- `deadline` Ã© obrigatÃ³rio e deve estar no formato `dd/mm/yyyy`.
- `priority` Ã© opcional e deve ser um nÃºmero entre 1 (alta) e 3 (baixa). O padrÃ£o Ã© 3.
- `subtasks` Ã© opcional. Se enviado, deve ser um array de objetos com `title` (string) e `done` (boolean).
- `tags` Ã© opcional. Se enviado, deve ser um array de strings com no mÃ¡ximo 5 itens.

#### âœ… Resposta:

```json
{
  "id": "123abc"
}
```

---

### âœï¸ PUT `/tasks/:id`

Atualiza uma tarefa existente (somente pelo criador).

#### ğŸ”’ Protegida? Sim

#### ğŸ“¥ Body (qualquer campo opcional):

```json
{
  "title": "TÃ­tulo atualizado",
  "description": "Nova descriÃ§Ã£o",
  "deadline": "20/04/2025",
  "priority": 1,
  "done": true,
  "subtasks": [
    { "title": "Item 1", "done": true },
    { "title": "Item 2", "done": false }
  ],
  "tags": ["tag1", "tag3"]
}
```

#### ğŸ” Regras:

- `title`, se enviado, deve ser uma string nÃ£o vazia.
- `description`, se enviado, Ã© opcional.
- `deadline`, se enviado, deve estar no formato `dd/mm/yyyy`.
- `priority`, se enviado, deve ser um nÃºmero entre 1 (alta) e 3 (baixa).
- `done`, se enviado, deve ser um booleano.
- `subtasks`, se enviado, deve ser um array de objetos com `title` (string) e `done` (boolean).
- `tags`, se enviado, deve ser um array de strings com no mÃ¡ximo 5 itens.
- Apenas o criador da tarefa (`uid`) pode atualizÃ¡-la.

#### âœ… Resposta:

```
200 OK
```

---

### ğŸ”— PUT `/tasks/:id/share`

Compartilha a tarefa com outros usuÃ¡rios informando seus e-mails.

#### ğŸ”’ Protegida? Sim

#### ğŸ“¥ Body:

```json
{
  "sharedWith": ["email1@exemplo.com", "email2@exemplo.com"]
}
```

#### ğŸ” Regras:

- Apenas o criador da tarefa pode compartilhÃ¡-la.
- A lista deve conter e-mails vÃ¡lidos em formato de string.
- Caso algum e-mail nÃ£o exista no banco de dados, a resposta incluirÃ¡ os e-mails invÃ¡lidos.

#### âœ… Exemplo de resposta (em caso de erro):

```json
{
  "error": "Os seguintes e-mails nÃ£o existem na base de dados",
  "invalidEmails": ["email_invalido@exemplo.com"]
}
```

---

### ğŸ”— GET `/users/search`

Busca usuÃ¡rios pelo e-mail.

#### ğŸ”’ Protegida? Sim

#### ğŸ“¥ Query Params:

```json
{
  "query": "parte_do_email"
}
```

#### ğŸ” Regras:

- O campo `query` deve ser uma string nÃ£o vazia.
- Retorna no mÃ¡ximo 10 resultados.

#### âœ… Exemplo de resposta:

```json
[
  {
    "email": "usuario@email.com",
    "picture": "avatar_1",
    "name": "UsuÃ¡rio Teste"
  }
]
```

---

### ğŸ’¬ ComentÃ¡rios â€“ `/comments`

#### ğŸ”¸ POST `/comments`

Adiciona um comentÃ¡rio a uma tarefa especÃ­fica.

##### ğŸ”’ Protegida? Sim

##### ğŸ“¥ Body:

```json
{
  "taskId": "abc123",
  "content": "Ã“timo progresso!"
}
```

##### ğŸ” Regras:

- `taskId` deve ser o ID de uma tarefa existente.
- `content` deve ser uma string nÃ£o vazia.

##### âœ… Resposta:

```
201 Created
```

---

#### ğŸ”¸ GET `/comments/:taskId`

Lista os comentÃ¡rios de uma tarefa.

##### ğŸ”’ Protegida? Sim

##### âœ… Exemplo de resposta:

```json
[
  {
    "id": "comment123",
    "author": "usuario@exemplo.com",
    "content": "Boa ideia!",
    "createdAt": "2025-04-14T12:34:56.789Z"
  }
]
```

---

### âŒ DELETE `/tasks/:id`

Remove uma tarefa do usuÃ¡rio (somente pelo criador).

#### ğŸ”’ Protegida? Sim

#### âœ… Resposta:

```
200 OK
```

---

### âŒ DELETE `/profile/delete-account`

Remove a conta do usuÃ¡rio autenticado.

#### ğŸ”’ Protegida? Sim

#### âœ… Resposta:

```
200 OK
```

---

## ğŸ› ï¸ Tecnologias utilizadas

- Node.js
- Express
- Typescript
- Jest
- Firebase Admin SDK
- Firestore
- JWT (via Firebase Auth)
- DOCKER

---

## ğŸš€ Deploy sugerido

- Subir este backend em uma instÃ¢ncia EC2 da AWS
- Utilizar `docker` para manter o servidor rodando
- Configurar porta (ex: 3000) e liberar via Security Group

---

ğŸ“˜ Desafio proposto por: **Gabriel Santos**